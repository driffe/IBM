<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NBA Mobile App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap');

        body {
            font-family: 'Poppins', sans-serif;
        }

        .tab-btn {
            position: relative;
            transition: all 0.3s ease;
        }

        .tab-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .tab-btn:hover:not(.active) {
            background-color: #f3f4f6;
            transform: translateY(-1px);
        }

        .loader {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .card-hover {
            transition: all 0.3s ease;
        }

        .card-hover:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.15);
        }

        .glass-effect {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
        }

        .nba-gradient {
            background: linear-gradient(135deg, #1e3a8a 0%, #7c3aed 50%, #dc2626 100%);
        }
    </style>
</head>
<body class="bg-gradient-to-br from-gray-50 to-gray-100 h-screen flex flex-col">

    <!-- Header -->
    <header class="nba-gradient text-white p-5 shadow-2xl">
        <div class="flex items-center justify-center gap-3">
            <span class="text-4xl">üèÄ</span>
            <div class="text-center">
                <h1 class="text-2xl font-bold tracking-tight">NBA Hub</h1>
                <p class="text-xs text-white/80">Your Ultimate Basketball Companion</p>
            </div>
        </div>
    </header>

    <!-- Tab Navigation -->
    <nav class="glass-effect shadow-lg flex justify-around overflow-x-auto">
        <button class="tab-btn py-4 px-2 flex-1 font-semibold text-xs rounded-t-lg active" data-tab="teams">
            <div class="flex flex-col items-center gap-1">
                <span class="text-lg">üë•</span>
                <span>Teams</span>
            </div>
        </button>
        <button class="tab-btn py-4 px-2 flex-1 font-semibold text-xs rounded-t-lg" data-tab="standings">
            <div class="flex flex-col items-center gap-1">
                <span class="text-lg">üèÜ</span>
                <span>Standings</span>
            </div>
        </button>
        <button class="tab-btn py-4 px-2 flex-1 font-semibold text-xs rounded-t-lg" data-tab="games">
            <div class="flex flex-col items-center gap-1">
                <span class="text-lg">üìÖ</span>
                <span>Games</span>
            </div>
        </button>
        <button class="tab-btn py-4 px-2 flex-1 font-semibold text-xs rounded-t-lg" data-tab="players">
            <div class="flex flex-col items-center gap-1">
                <span class="text-lg">‚≠ê</span>
                <span>Players</span>
            </div>
        </button>
        <button class="tab-btn py-4 px-2 flex-1 font-semibold text-xs rounded-t-lg" data-tab="recommend">
            <div class="flex flex-col items-center gap-1">
                <span class="text-lg">üéØ</span>
                <span>Find Team</span>
            </div>
        </button>
        <button class="tab-btn py-4 px-2 flex-1 font-semibold text-xs rounded-t-lg" data-tab="chatbot">
            <div class="flex flex-col items-center gap-1">
                <span class="text-lg">üí¨</span>
                <span>Chat</span>
            </div>
        </button>
    </nav>

    <!-- Tab Contents -->
    <main class="flex-1 overflow-y-auto p-4">

        <!-- Teams Tab -->
        <div id="teams" class="tab-content">
            <div class="mb-5">
                <div class="relative">
                    <input type="text" id="teamSearch" placeholder="üîç Search team by name..."
                        class="w-full p-4 pl-5 border-2 border-purple-200 rounded-2xl shadow-sm focus:border-purple-500 focus:ring-2 focus:ring-purple-200 transition-all outline-none text-lg">
                </div>
            </div>
            <div id="teamsList" class="space-y-4"></div>
        </div>

        <!-- Standings Tab -->
        <div id="standings" class="tab-content hidden">
            <div class="mb-5 grid grid-cols-3 gap-3">
                <button onclick="loadStandings('eastern')"
                    class="card-hover bg-gradient-to-br from-blue-500 to-blue-600 text-white py-3 rounded-2xl font-bold shadow-lg">
                    üîµ Eastern
                </button>
                <button onclick="loadStandings('western')"
                    class="card-hover bg-gradient-to-br from-red-500 to-red-600 text-white py-3 rounded-2xl font-bold shadow-lg">
                    üî¥ Western
                </button>
                <button onclick="loadStandings('all')"
                    class="card-hover bg-gradient-to-br from-green-500 to-green-600 text-white py-3 rounded-2xl font-bold shadow-lg">
                    üèÜ All
                </button>
            </div>
            <div id="standingsList" class="space-y-4"></div>
        </div>

        <!-- Games Tab -->
        <div id="games" class="tab-content hidden">
            <div class="mb-5 space-y-3">
                <input type="text" id="gameTeamSearch" placeholder="üèÄ Search by team name..."
                    class="w-full p-4 border-2 border-purple-200 rounded-2xl shadow-sm focus:border-purple-500 focus:ring-2 focus:ring-purple-200 transition-all outline-none">
                <input type="date" id="gameDateSearch"
                    class="w-full p-4 border-2 border-purple-200 rounded-2xl shadow-sm focus:border-purple-500 focus:ring-2 focus:ring-purple-200 transition-all outline-none">
                <button onclick="searchGames()"
                    class="card-hover w-full bg-gradient-to-r from-purple-600 to-pink-600 text-white py-4 rounded-2xl font-bold shadow-lg">
                    üîç Search Games
                </button>
                <button onclick="loadAllGames()"
                    class="card-hover w-full bg-gradient-to-r from-gray-600 to-gray-700 text-white py-3 rounded-2xl font-semibold shadow-lg">
                    üìã Show All Games
                </button>
            </div>
            <div id="gamesList" class="space-y-4"></div>
        </div>

        <!-- Players Tab -->
        <div id="players" class="tab-content hidden">
            <div class="mb-5 space-y-3">
                <input type="text" id="playerName" placeholder="üë§ Player name..."
                    class="w-full p-4 border-2 border-purple-200 rounded-2xl shadow-sm focus:border-purple-500 focus:ring-2 focus:ring-purple-200 transition-all outline-none">
                <input type="text" id="playerPosition" placeholder="üèÉ Position (e.g., G, F, C)"
                    class="w-full p-4 border-2 border-purple-200 rounded-2xl shadow-sm focus:border-purple-500 focus:ring-2 focus:ring-purple-200 transition-all outline-none">
                <input type="text" id="playerCountry" placeholder="üåç Country..."
                    class="w-full p-4 border-2 border-purple-200 rounded-2xl shadow-sm focus:border-purple-500 focus:ring-2 focus:ring-purple-200 transition-all outline-none">
                <button onclick="searchPlayers()"
                    class="card-hover w-full bg-gradient-to-r from-purple-600 to-pink-600 text-white py-4 rounded-2xl font-bold shadow-lg">
                    ‚≠ê Search Players
                </button>
            </div>
            <div id="playerResults" class="space-y-4"></div>
        </div>

        <!-- Team Recommendation Tab -->
        <div id="recommend" class="tab-content hidden">
            <div class="bg-white rounded-lg p-6 shadow mb-4">
                <h2 class="text-2xl font-bold text-center mb-2">üéØ Find Your NBA Team</h2>
                <p class="text-center text-gray-600 mb-6">Answer a few questions to get personalized team recommendations!</p>
            </div>

            <div id="surveyContainer" class="space-y-4">
                <!-- Question 1 -->
                <div class="bg-white rounded-lg p-4 shadow">
                    <h3 class="font-bold mb-3">1. What's your playing style preference?</h3>
                    <div class="space-y-2">
                        <label class="flex items-center p-3 border rounded hover:bg-gray-50 cursor-pointer">
                            <input type="radio" name="q1" value="offensive" class="mr-3">
                            <span>Offensive powerhouse - High scoring, fast-paced</span>
                        </label>
                        <label class="flex items-center p-3 border rounded hover:bg-gray-50 cursor-pointer">
                            <input type="radio" name="q1" value="defensive" class="mr-3">
                            <span>Defensive minded - Strong defense, tactical play</span>
                        </label>
                        <label class="flex items-center p-3 border rounded hover:bg-gray-50 cursor-pointer">
                            <input type="radio" name="q1" value="balanced" class="mr-3">
                            <span>Balanced approach - Mix of offense and defense</span>
                        </label>
                    </div>
                </div>

                <!-- Question 2 -->
                <div class="bg-white rounded-lg p-4 shadow">
                    <h3 class="font-bold mb-3">2. Which conference do you prefer?</h3>
                    <div class="space-y-2">
                        <label class="flex items-center p-3 border rounded hover:bg-gray-50 cursor-pointer">
                            <input type="radio" name="q2" value="eastern" class="mr-3">
                            <span>Eastern Conference</span>
                        </label>
                        <label class="flex items-center p-3 border rounded hover:bg-gray-50 cursor-pointer">
                            <input type="radio" name="q2" value="western" class="mr-3">
                            <span>Western Conference</span>
                        </label>
                        <label class="flex items-center p-3 border rounded hover:bg-gray-50 cursor-pointer">
                            <input type="radio" name="q2" value="any" class="mr-3">
                            <span>No preference</span>
                        </label>
                    </div>
                </div>

                <!-- Question 3 -->
                <div class="bg-white rounded-lg p-4 shadow">
                    <h3 class="font-bold mb-3">3. What kind of team history do you like?</h3>
                    <div class="space-y-2">
                        <label class="flex items-center p-3 border rounded hover:bg-gray-50 cursor-pointer">
                            <input type="radio" name="q3" value="legacy" class="mr-3">
                            <span>Championship legacy - Teams with multiple titles</span>
                        </label>
                        <label class="flex items-center p-3 border rounded hover:bg-gray-50 cursor-pointer">
                            <input type="radio" name="q3" value="underdog" class="mr-3">
                            <span>Underdog story - Rising teams with potential</span>
                        </label>
                        <label class="flex items-center p-3 border rounded hover:bg-gray-50 cursor-pointer">
                            <input type="radio" name="q3" value="consistent" class="mr-3">
                            <span>Consistent performers - Steady playoff contenders</span>
                        </label>
                    </div>
                </div>

                <!-- Question 4 -->
                <div class="bg-white rounded-lg p-4 shadow">
                    <h3 class="font-bold mb-3">4. What type of star player do you prefer?</h3>
                    <div class="space-y-2">
                        <label class="flex items-center p-3 border rounded hover:bg-gray-50 cursor-pointer">
                            <input type="radio" name="q4" value="scorer" class="mr-3">
                            <span>Elite scorer - Dominant offensive player</span>
                        </label>
                        <label class="flex items-center p-3 border rounded hover:bg-gray-50 cursor-pointer">
                            <input type="radio" name="q4" value="allround" class="mr-3">
                            <span>All-around player - Does everything well</span>
                        </label>
                        <label class="flex items-center p-3 border rounded hover:bg-gray-50 cursor-pointer">
                            <input type="radio" name="q4" value="team" class="mr-3">
                            <span>Team player - Great assists and teamwork</span>
                        </label>
                    </div>
                </div>

                <!-- Question 5 -->
                <div class="bg-white rounded-lg p-4 shadow">
                    <h3 class="font-bold mb-3">5. What's your preferred team vibe?</h3>
                    <div class="space-y-2">
                        <label class="flex items-center p-3 border rounded hover:bg-gray-50 cursor-pointer">
                            <input type="radio" name="q5" value="young" class="mr-3">
                            <span>Young and exciting - Fresh talent, high energy</span>
                        </label>
                        <label class="flex items-center p-3 border rounded hover:bg-gray-50 cursor-pointer">
                            <input type="radio" name="q5" value="veteran" class="mr-3">
                            <span>Veteran leadership - Experienced, championship-ready</span>
                        </label>
                        <label class="flex items-center p-3 border rounded hover:bg-gray-50 cursor-pointer">
                            <input type="radio" name="q5" value="mixed" class="mr-3">
                            <span>Mix of both - Balance of youth and experience</span>
                        </label>
                    </div>
                </div>

                <button onclick="getRecommendation()"
                    class="w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white py-4 rounded-lg font-bold text-lg shadow-lg hover:shadow-xl transition">
                    Get My Team Recommendation üöÄ
                </button>
            </div>

            <div id="recommendResult" class="hidden space-y-4 mt-4"></div>
        </div>

        <!-- Chatbot Tab -->
        <div id="chatbot" class="tab-content hidden h-full flex flex-col">
            <div id="chatMessages" class="flex-1 overflow-y-auto space-y-3 mb-4 bg-white rounded-lg p-4 shadow">
                <div class="text-center text-gray-500 py-8">
                    üëã Hi! I'm your NBA assistant. Ask me anything about NBA teams, players, or games!
                </div>
            </div>
            <div class="bg-white p-3 rounded-lg shadow">
                <div class="flex gap-2">
                    <input type="text" id="chatInput" placeholder="Ask me about NBA..."
                        class="flex-1 p-3 border rounded-lg"
                        onkeypress="if(event.key==='Enter') sendMessage()">
                    <button onclick="sendMessage()"
                        class="bg-blue-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-blue-700">
                        Send
                    </button>
                </div>
            </div>
        </div>

    </main>

    <!-- Team Detail Modal -->
    <div id="teamModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-lg max-w-2xl w-full max-h-[80vh] overflow-y-auto">
            <div class="sticky top-0 bg-white border-b p-4 flex justify-between items-center">
                <h2 id="modalTeamName" class="text-xl font-bold"></h2>
                <button onclick="closeModal()" class="text-2xl font-bold">&times;</button>
            </div>
            <div class="p-4">
                <div id="modalTeamStanding" class="mb-4"></div>
                <h3 class="text-lg font-bold mb-3">Team Roster</h3>
                <div id="modalTeamRoster" class="space-y-2"></div>
            </div>
        </div>
    </div>

    <!-- Team Recommendation Result Modal -->
    <div id="recommendModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-lg max-w-3xl w-full max-h-[80vh] overflow-y-auto">
            <div class="sticky top-0 bg-gradient-to-r from-green-400 to-blue-500 text-white p-6 flex justify-between items-center">
                <h2 class="text-2xl font-bold">üéâ Your Perfect NBA Teams!</h2>
                <button onclick="closeRecommendModal()" class="text-3xl font-bold hover:text-gray-200">&times;</button>
            </div>
            <div id="recommendModalContent" class="p-6"></div>
            <div class="sticky bottom-0 bg-white border-t p-4 flex gap-3">
                <button onclick="resetSurvey(); closeRecommendModal();"
                    class="flex-1 bg-gray-600 text-white py-3 rounded-lg font-semibold hover:bg-gray-700">
                    Take Survey Again
                </button>
                <button onclick="goToTeamsTab()"
                    class="flex-1 bg-blue-600 text-white py-3 rounded-lg font-semibold hover:bg-blue-700">
                    Explore Teams
                </button>
            </div>
        </div>
    </div>

    <script>
        const baseUrl = "http://127.0.0.1:8000";
        let allTeams = [];
        let currentTab = 'teams';

        // Tab switching
        const tabBtns = document.querySelectorAll('.tab-btn');
        const tabContents = document.querySelectorAll('.tab-content');

        tabBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                currentTab = btn.dataset.tab;
                tabBtns.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                tabContents.forEach(tc => tc.classList.add('hidden'));
                document.getElementById(currentTab).classList.remove('hidden');

                // Load data when switching tabs
                if (currentTab === 'teams' && allTeams.length === 0) loadTeams();
                if (currentTab === 'standings') loadStandings('all');
                if (currentTab === 'games') loadAllGames();
            });
        });

        // Utility functions
        function showLoader(containerId) {
            document.getElementById(containerId).innerHTML = '<div class="loader"></div>';
        }

        function showError(containerId, message) {
            document.getElementById(containerId).innerHTML =
                `<div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded">${message}</div>`;
        }

        // Teams functions
        async function loadTeams() {
            showLoader('teamsList');
            try {
                const res = await fetch(`${baseUrl}/teams`);
                allTeams = await res.json();
                displayTeams(allTeams);
            } catch (error) {
                showError('teamsList', 'Failed to load teams');
            }
        }

        function displayTeams(teams) {
            const container = document.getElementById('teamsList');
            container.innerHTML = '';
            teams.forEach((team, index) => {
                const colors = ['from-blue-500 to-purple-600', 'from-purple-500 to-pink-600', 'from-green-500 to-teal-600', 'from-orange-500 to-red-600'];
                const color = colors[index % colors.length];
                container.innerHTML += `
                    <div class="card-hover bg-white p-5 rounded-2xl shadow-lg cursor-pointer overflow-hidden relative"
                        onclick="showTeamDetail(${team.id})">
                        <div class="absolute top-0 right-0 w-32 h-32 bg-gradient-to-br ${color} opacity-10 rounded-full -mr-16 -mt-16"></div>
                        <div class="flex justify-between items-center relative z-10">
                            <div>
                                <p class="font-bold text-xl bg-gradient-to-r ${color} bg-clip-text text-transparent">${team.name}</p>
                                <p class="text-sm text-gray-400 mt-1">Team ID: ${team.id}</p>
                            </div>
                            <div class="bg-gradient-to-br ${color} p-3 rounded-xl">
                                <span class="text-white text-2xl">‚Üí</span>
                            </div>
                        </div>
                    </div>
                `;
            });
        }

        // Team search
        document.getElementById('teamSearch').addEventListener('input', (e) => {
            const searchTerm = e.target.value.toLowerCase();
            const filtered = allTeams.filter(team =>
                team.name.toLowerCase().includes(searchTerm)
            );
            displayTeams(filtered);
        });

        // Team detail modal
        async function showTeamDetail(teamId) {
            try {
                // Fetch team details
                const teamRes = await fetch(`${baseUrl}/teams/${teamId}`);
                const team = await teamRes.json();

                // Fetch team standing
                const standingRes = await fetch(`${baseUrl}/teams/${teamId}/standing`);
                const standing = await standingRes.json();

                // Display in modal
                document.getElementById('modalTeamName').textContent = team.name;

                // Display standing
                const standingDiv = document.getElementById('modalTeamStanding');
                const s = standing.standing;
                standingDiv.innerHTML = `
                    <div class="bg-blue-50 p-4 rounded-lg">
                        <h3 class="font-bold mb-2">Standing (${standing.conference || 'Conference'})</h3>
                        <div class="grid grid-cols-3 gap-2 text-sm">
                            <div><strong>W:</strong> ${s.W}</div>
                            <div><strong>L:</strong> ${s.L}</div>
                            <div><strong>PCT:</strong> ${s.PCT}</div>
                            <div><strong>GB:</strong> ${s.GB}</div>
                            <div><strong>L10:</strong> ${s.L10}</div>
                            <div><strong>Streak:</strong> ${s.Strk}</div>
                        </div>
                    </div>
                `;

                // Display roster
                const rosterDiv = document.getElementById('modalTeamRoster');
                rosterDiv.innerHTML = '';
                team.roster.forEach(player => {
                    rosterDiv.innerHTML += `
                        <div class="bg-gray-50 p-3 rounded border">
                            <p class="font-semibold">${player.name}</p>
                            <div class="text-sm text-gray-600 grid grid-cols-2 gap-1 mt-1">
                                <div><strong>Pos:</strong> ${player.position}</div>
                                <div><strong>Height:</strong> ${player.height}</div>
                                <div><strong>Weight:</strong> ${player.weight}</div>
                                <div><strong>Country:</strong> ${player.country}</div>
                                <div class="col-span-2"><strong>Last Attended:</strong> ${player.last_attended}</div>
                            </div>
                        </div>
                    `;
                });

                document.getElementById('teamModal').classList.remove('hidden');
            } catch (error) {
                alert('Failed to load team details');
            }
        }

        function closeModal() {
            document.getElementById('teamModal').classList.add('hidden');
        }

        // Standings functions
        async function loadStandings(conference) {
            showLoader('standingsList');
            try {
                let standings = [];
                if (conference === 'all') {
                    const eastRes = await fetch(`${baseUrl}/standings/eastern`);
                    const westRes = await fetch(`${baseUrl}/standings/western`);
                    const east = await eastRes.json();
                    const west = await westRes.json();
                    standings = [
                        ...east.map(s => ({...s, Conference: 'Eastern'})),
                        ...west.map(s => ({...s, Conference: 'Western'}))
                    ];
                } else {
                    const res = await fetch(`${baseUrl}/standings/${conference}`);
                    standings = await res.json();
                    standings = standings.map(s => ({...s, Conference: conference}));
                }
                displayStandings(standings);
            } catch (error) {
                showError('standingsList', 'Failed to load standings');
            }
        }

        function displayStandings(standings) {
            const container = document.getElementById('standingsList');
            container.innerHTML = '';

            let currentConference = '';
            standings.forEach((s, index) => {
                if (s.Conference && s.Conference !== currentConference) {
                    currentConference = s.Conference;
                    container.innerHTML += `
                        <div class="bg-gradient-to-r ${currentConference === 'Eastern' ? 'from-blue-600 to-blue-700' : 'from-red-600 to-red-700'} text-white p-3 rounded-lg font-bold text-center">
                            ${currentConference} Conference
                        </div>
                    `;
                }

                container.innerHTML += `
                    <div class="bg-white p-4 rounded-lg shadow">
                        <div class="flex justify-between items-center mb-2">
                            <div>
                                <span class="text-2xl font-bold text-gray-400">${index + 1}</span>
                                <span class="ml-3 font-bold text-lg">${s.Team}</span>
                            </div>
                            <div class="text-right">
                                <div class="text-lg font-bold">${s.W}-${s.L}</div>
                                <div class="text-sm text-gray-500">${s.PCT}</div>
                            </div>
                        </div>
                        <div class="grid grid-cols-3 gap-2 text-sm text-gray-600">
                            <div><strong>GB:</strong> ${s.GB}</div>
                            <div><strong>L10:</strong> ${s.L10}</div>
                            <div><strong>Streak:</strong> ${s.Strk}</div>
                        </div>
                    </div>
                `;
            });
        }

        // Games functions
        async function loadAllGames() {
            showLoader('gamesList');
            try {
                const res = await fetch(`${baseUrl}/games`);
                const games = await res.json();
                displayGames(games);
            } catch (error) {
                showError('gamesList', 'Failed to load games');
            }
        }

        async function searchGames() {
            const team = document.getElementById('gameTeamSearch').value;
            const date = document.getElementById('gameDateSearch').value;

            if (!team && !date) {
                loadAllGames();
                return;
            }

            showLoader('gamesList');
            try {
                const params = new URLSearchParams();
                if (team) params.append('team', team);
                if (date) params.append('date', date);

                const res = await fetch(`${baseUrl}/games/search?${params}`);
                if (res.ok) {
                    const games = await res.json();
                    displayGames(games);
                } else {
                    showError('gamesList', 'No games found');
                }
            } catch (error) {
                showError('gamesList', 'Failed to search games');
            }
        }

        function displayGames(games) {
            const container = document.getElementById('gamesList');
            container.innerHTML = '';

            if (games.length === 0) {
                container.innerHTML = '<div class="text-center text-gray-500 py-8">No games found</div>';
                return;
            }

            games.forEach(game => {
                container.innerHTML += `
                    <div class="bg-white p-4 rounded-lg shadow">
                        <div class="flex justify-between items-center mb-2">
                            <div class="flex-1">
                                <p class="font-bold text-lg">${game.team1}</p>
                                <p class="text-gray-500 text-sm">vs</p>
                                <p class="font-bold text-lg">${game.team2}</p>
                            </div>
                            <div class="text-right">
                                <div class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm font-semibold mb-1">
                                    ${game.date}
                                </div>
                                <div class="text-sm text-gray-600">üìç ${game.location}</div>
                            </div>
                        </div>
                    </div>
                `;
            });
        }

        // Players functions
        async function searchPlayers() {
            const name = document.getElementById('playerName').value;
            const position = document.getElementById('playerPosition').value;
            const country = document.getElementById('playerCountry').value;

            if (!name && !position && !country) {
                document.getElementById('playerResults').innerHTML =
                    '<div class="text-center text-gray-500 py-8">Enter search criteria</div>';
                return;
            }

            showLoader('playerResults');
            try {
                const params = new URLSearchParams();
                if (name) params.append('name', name);
                if (position) params.append('position', position);
                if (country) params.append('country', country);

                const res = await fetch(`${baseUrl}/search/players?${params}`);
                if (res.ok) {
                    const data = await res.json();
                    displayPlayers(data.results, data.count);
                } else {
                    showError('playerResults', 'No players found');
                }
            } catch (error) {
                showError('playerResults', 'Failed to search players');
            }
        }

        function displayPlayers(results, count) {
            const container = document.getElementById('playerResults');
            container.innerHTML = `
                <div class="bg-green-100 border border-green-400 text-green-700 px-4 py-2 rounded mb-3">
                    Found ${count} player(s)
                </div>
            `;

            results.forEach(result => {
                const p = result.player;
                container.innerHTML += `
                    <div class="bg-white p-4 rounded-lg shadow">
                        <div class="flex justify-between items-start mb-2">
                            <div>
                                <p class="font-bold text-lg">${p.name}</p>
                                <p class="text-sm text-blue-600 font-semibold">${result.team}</p>
                            </div>
                            <span class="bg-purple-100 text-purple-800 px-3 py-1 rounded-full text-sm font-bold">
                                ${p.position}
                            </span>
                        </div>
                        <div class="grid grid-cols-2 gap-2 text-sm text-gray-600">
                            <div><strong>Height:</strong> ${p.height}</div>
                            <div><strong>Weight:</strong> ${p.weight}</div>
                            <div><strong>Country:</strong> ${p.country}</div>
                            <div class="col-span-2"><strong>Last Attended:</strong> ${p.last_attended}</div>
                        </div>
                    </div>
                `;
            });
        }

        // Chatbot functions
        let chatHistory = [
            {
                role: "system",
                content: `You are an NBA assistant for a mobile app that provides NBA information.

                Our app has the following features and data:
                - 30 NBA teams with their rosters (players' names, positions, height, weight, country, last attended school)
                - Eastern and Western Conference standings (Wins, Losses, PCT, Games Behind, Last 10 games, Streak)
                - Game schedules with dates and locations
                - Player search by name, position, or country

                When users ask questions:
                1. Provide accurate, helpful information about NBA teams, players, and games
                2. If they ask about specific teams or players, mention they can use the Teams, Players, or Games tabs to find detailed information
                3. For standings questions, refer to the Standings tab which shows both Eastern and Western conferences
                4. Be friendly, concise, and enthusiastic about basketball
                5. If you don't have specific data, acknowledge it and suggest using the app's search features

                Answer in a conversational, helpful tone. Keep responses brief but informative.`
            }
        ];

        async function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();

            if (!message) return;

            // Display user message
            addMessageToChat('user', message);
            input.value = '';

            // Add to chat history
            chatHistory.push({
                role: "user",
                content: message
            });

            // Show loading
            const messagesDiv = document.getElementById('chatMessages');
            const loadingId = 'loading-' + Date.now();
            messagesDiv.innerHTML += `
                <div id="${loadingId}" class="flex justify-start">
                    <div class="bg-gray-200 rounded-lg p-3 max-w-[80%]">
                        <div class="loader" style="width: 20px; height: 20px; margin: 0;"></div>
                    </div>
                </div>
            `;
            messagesDiv.scrollTop = messagesDiv.scrollHeight;

            try {
                const res = await fetch(`${baseUrl}/chat`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ messages: chatHistory })
                });

                // Remove loading indicator
                document.getElementById(loadingId).remove();

                if (res.ok) {
                    const data = await res.json();
                    const botResponse = data.response;

                    // Add to chat history
                    chatHistory.push({
                        role: "assistant",
                        content: botResponse
                    });

                    // Display bot message
                    addMessageToChat('assistant', botResponse);
                } else {
                    addMessageToChat('error', 'Sorry, I encountered an error. Please try again.');
                }
            } catch (error) {
                document.getElementById(loadingId)?.remove();
                addMessageToChat('error', 'Failed to connect to chatbot. Please check if the server is running.');
            }
        }

        function addMessageToChat(role, message) {
            const messagesDiv = document.getElementById('chatMessages');

            // Remove welcome message if exists
            if (messagesDiv.querySelector('.text-center.text-gray-500')) {
                messagesDiv.innerHTML = '';
            }

            const isUser = role === 'user';
            const isError = role === 'error';
            const bgColor = isUser ? 'bg-blue-600 text-white' : isError ? 'bg-red-100 text-red-700' : 'bg-gray-200';
            const alignment = isUser ? 'justify-end' : 'justify-start';

            messagesDiv.innerHTML += `
                <div class="flex ${alignment}">
                    <div class="${bgColor} rounded-lg p-3 max-w-[80%]">
                        <p class="text-sm whitespace-pre-wrap">${message}</p>
                    </div>
                </div>
            `;

            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }

        // Team Recommendation function
        async function getRecommendation() {
            const answers = {
                q1: document.querySelector('input[name="q1"]:checked'),
                q2: document.querySelector('input[name="q2"]:checked'),
                q3: document.querySelector('input[name="q3"]:checked'),
                q4: document.querySelector('input[name="q4"]:checked'),
                q5: document.querySelector('input[name="q5"]:checked')
            };

            for (let key in answers) {
                if (!answers[key]) {
                    alert('Please answer all questions before getting recommendations!');
                    return;
                }
            }

            const userPreferences = `
Playing style: ${answers.q1.value}
Conference: ${answers.q2.value}
Team history: ${answers.q3.value}
Star player type: ${answers.q4.value}
Team vibe: ${answers.q5.value}
            `.trim();

            const resultDiv = document.getElementById('recommendResult');
            resultDiv.classList.remove('hidden');
            resultDiv.innerHTML = '<div class="loader"></div>';
            document.getElementById('surveyContainer').style.opacity = '0.5';

            try {
                const messages = [
                    {
                        role: "system",
                        content: `You are an NBA team recommendation expert. Based on user preferences, recommend 3 NBA teams that match their criteria.

                        Available NBA teams include all 30 teams across Eastern and Western conferences.

                        Provide recommendations in this EXACT format:
                        1. **[Team Name]** - [Brief explanation why this team matches their preferences, 2-3 sentences]

                        2. **[Team Name]** - [Brief explanation why this team matches their preferences, 2-3 sentences]

                        3. **[Team Name]** - [Brief explanation why this team matches their preferences, 2-3 sentences]

                        Be specific about team characteristics, playing style, and why they match the user's preferences. Keep each explanation concise but informative.`
                    },
                    {
                        role: "user",
                        content: `Based on these preferences, recommend 3 NBA teams for me:\n\n${userPreferences}`
                    }
                ];

                const res = await fetch(`${baseUrl}/chat`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ messages })
                });

                if (res.ok) {
                    const data = await res.json();
                    const recommendations = data.response;

                    // Show modal with recommendations
                    document.getElementById('recommendModalContent').innerHTML = `
                        <div class="prose prose-sm max-w-none">
                            ${recommendations.replace(/\n/g, '<br>')}
                        </div>
                    `;
                    document.getElementById('recommendModal').classList.remove('hidden');
                    document.getElementById('surveyContainer').style.opacity = '1';
                    resultDiv.classList.add('hidden');
                } else {
                    throw new Error('Failed to get recommendations');
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded">
                        Failed to get recommendations. Please try again.
                    </div>
                `;
                document.getElementById('surveyContainer').style.opacity = '1';
            }
        }

        function closeRecommendModal() {
            document.getElementById('recommendModal').classList.add('hidden');
        }

        function goToTeamsTab() {
            closeRecommendModal();
            document.querySelector('[data-tab="teams"]').click();
        }

        function resetSurvey() {
            document.querySelectorAll('input[type="radio"]').forEach(input => {
                input.checked = false;
            });
            document.getElementById('recommendResult').classList.add('hidden');
            document.getElementById('surveyContainer').style.opacity = '1';
            document.querySelector('#recommend').scrollTop = 0;
        }

        // Initialize - load teams on startup
        loadTeams();
    </script>
</body>
</html>
